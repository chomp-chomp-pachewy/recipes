<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>chomp recipes</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    /* ---------------------------------------------------- */
    /* === BASE STYLES & LAYOUT === */
    /* ---------------------------------------------------- */

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: #fdfdfd;
      color: #434343;
      line-height: 1.7;
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 300px;
      background-color: #f8f8f8;
      border-right: 1px solid #e0e0e0;
      overflow-y: auto;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
    }

    .recipe-list-container {
      position: relative;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      flex-grow: 1;
      mask-image: linear-gradient(to bottom, black 95%, transparent 100%);
      -webkit-mask-image: linear-gradient(to bottom, black 95%, transparent 100%);
    }

    .sidebar-header {
      padding: 30px 20px 20px 20px;
      text-align: center;
      cursor: pointer;
      flex-shrink: 0;
    }

    .sidebar-title {
      font-size: 1.6em;
      font-weight: 700;
      color: #d3687e;
      flex-shrink: 0;
    }

    /* ---------------------------------------------------- */
    /* === SEARCH & LIST ITEMS === */
    /* ---------------------------------------------------- */

    .search-box {
      width: calc(100% - 40px);
      margin: 0 20px 20px 20px;
      padding: 12px 16px;
      font-size: 15px;
      font-family: 'Inter', sans-serif;
      border: 1px solid #434343;
      border-radius: 8px;
      background-color: #ffffff;
      color: #434343;
      flex-shrink: 0;
    }

    .search-box:focus { outline: none; border-color: #d3687e; }

    .recipe-list { list-style: none; padding: 0; margin: 0; }

    .recipe-item {
      padding: 16px 20px;
      cursor: pointer;
      border-bottom: 1px solid #e0e0e0;
      transition: background-color 0.2s;
    }

    .recipe-item:last-child { border-bottom: none; }

    .recipe-item:hover { background-color: #f0f0f0; }

    .recipe-item.active {
      background-color: #d3687e;
      color: #ffffff;
    }

    .recipe-name {
      font-weight: 400;
      font-size: 1em;
      color: #9e9e9e;
    }

    .recipe-item.active .recipe-name { color: #ffffff; }

    .recipe-item.active .recipe-time { color: rgba(255, 255, 255, 0.8); }

    .sticky-indicator {
      position: sticky;
      bottom: 0;
      text-align: center;
      background: rgba(253,253,253,0.9);
      padding: 8px 0;
      font-size: 0.85em;
      color: #777;
      opacity: 1;
      transition: opacity 0.3s ease;
      display: none;
    }

    .top-shadow {
      position: sticky;
      top: 0;
      width: 100%;
      height: 24px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.25s ease;
      background:
        linear-gradient(to bottom,
          rgba(253,253,253,1) 0%,
          rgba(253,253,253,0) 90%),
        linear-gradient(to bottom,
          rgba(0,0,0,0.15),
          rgba(0,0,0,0));
    }


    /* ---------------------------------------------------- */
    /* === RECIPE CONTENT === */
    /* ---------------------------------------------------- */

    .recipe-content {
      flex: 1;
      overflow-y: auto;
      padding: 40px 60px;
      max-width: 900px;
    }

    .recipe-header { margin-bottom: 30px; }

    .recipe-title {
      font-size: 2.1em;
      font-weight: 300;
      color: #d3687e;
      margin-bottom: 15px;
      line-height: 1.2;
    }

    .recipe-meta {
      color: #666666;
      font-size: 0.95em;
      margin-bottom: 10px;
    }

    .recipe-meta span { margin-right: 0 !important; }

    .recipe-description {
      font-weight: 300;
      line-height: 1.8;
      margin-bottom: 25px;
      font-size: 1em;
    }

    .recipe-image {
      display: block;
      max-width: 50%;
      border-radius: 8px;
      margin: 0 auto 20px auto;
    }

    /* ---------------------------------------------------- */
    /* === HOME / MANIFESTO === */
    /* ---------------------------------------------------- */

    .home-text {
      text-align: left;
      padding: 50px 0;
      max-width: 600px;
      margin: 0 auto;
      font-size: 1.05em;
      font-family: 'Inter', sans-serif;
      line-height: 1.85;
    }

    .home-text .home-image {
      width: 100%;
      max-width: 300px;
      margin-bottom: 30px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .home-text .recipe-title {
      font-weight: 700 !important;
      text-transform: none !important;
    }

    .manifesto-title .manifesto-line-1 {
      font-weight: 700 !important;
      text-decoration: none;
      text-underline-offset: 4px;
    }

    .home-text,
    .home-text .recipe-description {
      color: #1a1a1a !important;
      font-size: 1em !important;
      line-height: 1.9 !important;
    }

    /* ---------------------------------------------------- */
    /* === ACTIONS & SECTIONS === */
    /* ---------------------------------------------------- */

    .recipe-actions {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
    }

    .recipe-action-button {
      font-family: 'Inter', sans-serif !important;
      font-size: 0.95em;
      padding: 6px 10px;
      background: transparent;
      border: 1px solid #d3687e;
      color: #d3687e;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .recipe-action-button:hover {
      background-color: #d3687e;
      color: #ffffff;
    }

    .section-title {
      color: #d3687e;
      font-size: 1.2em;
      font-weight: 700;
      margin: 35px 0 15px 0;
      text-transform: lowercase;
    }

    .ingredients-list { list-style: none; }

    .ingredient-item {
      padding: 8px 0 8px 16px;
      border-left: 3px solid #d3687e;
      margin-bottom: 8px;
      font-weight: 300;
    }

    .instructions-list { list-style: none; counter-reset: step-counter; }

    .instruction-item {
      counter-increment: step-counter;
      margin-bottom: 20px;
      padding-left: 40px;
      position: relative;
      font-weight: 300;
      line-height: 1.8;
    }

    .instruction-item::before {
      content: counter(step-counter);
      position: absolute;
      left: 0;
      top: 0;
      width: 28px;
      height: 28px;
      background-color: #d3687e;
      color: #ffffff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9em;
    }

    .notes-section {
      background-color: #f8f8f8;
      padding: 20px;
      border-radius: 8px;
      margin-top: 30px;
      font-weight: 300;
    }

    .no-recipe {
      padding: 20px;
      text-align: center;
      color: #666666;
    }

    a.email-link { color: #d3687e; font-weight: 700; text-decoration: none; }

    /* ---------------------------------------------------- */
    /* === DARK MODE OVERRIDES === */
    /* ---------------------------------------------------- */

    @media (prefers-color-scheme: dark) {

      /* Base */
      body {
        background: #2a2a2a;
        color: #f5f5f5;
      }

      .recipe-content {
        background: #2a2a2a;
      }

      /* NEW: darker sidebar for visibility */
      .sidebar {
        background-color: #2a2a2a !important;
      }

      /* NEW: readable sidebar text */
      .sidebar-title,
      .recipe-name {
        color: #f5f5f5 !important;
      }

      .recipe-item.active .recipe-name {
        color: #ffffff !important;
      }

      .home-text,
      .home-text .recipe-description,
      .home-text h1,
      .home-text h2 {
        color: #f5f5f5 !important;
      }

      .recipe-meta {
        color: #C7D2E0;
      }

      .recipe-title,
      .section-title,
      .sidebar-title,
      .email-link {
        color: #d3687e !important;
      }

      .ingredient-item {
        border-left-color: #d3687e;
      }

      .instruction-item::before {
        background-color: #d3687e;
      }

      .recipe-action-button {
        border: 1px solid #d3687e;
        color: #d3687e;
      }

      .recipe-action-button:hover {
        background: #d3687e;
        color: #ffffff;
      }

      .sticky-indicator {
        background: #404040;
        color: #f5f5f5;
      }

      .top-shadow {
        background:
          linear-gradient(to bottom,
          rgba(42, 42, 42, 1) 0%,
          rgba(42, 42, 42, 0) 90%);
      }
    }

  </style>
</head>
<body>

  <div class="sidebar">
    <div class="sidebar-header" onclick="resetRecipeView()">
      <div class="sidebar-title">rituals / recipes</div>
    </div>

    <input type="text" class="search-box" id="searchBox" placeholder="search recipes...">
    
    <div class="recipe-list-container">
      <ul class="recipe-list" id="recipeList"></ul>
      <div id="stickyIndicator" class="sticky-indicator"></div>
      <div class="top-shadow"></div>
      <div class="no-results" id="noResults" style="display:none;">no recipes found</div>
    </div>
  </div>

  <div class="recipe-content" id="recipeContent"></div>

  <script>
    let recipes = [];
    let currentRecipe = null;

    function printRecipe(){ window.print(); }

    function generateSlug(title){
      return title
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g,'')
        .replace(/\s+/g,'-')
        .replace(/-+/g,'-')
        .trim('-');
    }

    function copyPermalink(){
      if(!currentRecipe||!currentRecipe.slug) return;
      const url = `${window.location.origin}${window.location.pathname}?slug=${encodeURIComponent(currentRecipe.slug)}`;
      navigator.clipboard.writeText(url);
    }

    const HOME_CONTENT_HTML = `
      <div class="home-text">
        <img src="images/Chomp Chomp logos.jpeg" class="home-image">

        <h1 class="recipe-title" style="font-size:2em;">Recipes & Rituals</h1>
        <h2 class="section-title manifesto-title" style="font-size:1.2em;">Baking as Community</h2>

        <p class="recipe-description">
          Baking. What is baking, <em>really</em>? It is not simply the combination of flour, sugar, butter, and eggs.
          No: this would be far too na√Øve. Baking is the materialization of <span style="color:#d3687e;">comfort itself</span>.
        </p>

        <p class="recipe-description">
          But in this gap lies the <span style="color:#d3687e;">zen of baking</span>.
        </p>

        <p class="recipe-description">
          Culturally, baking binds us. Across centuries, sharing bread forms a <span style="color:#d3687e;">network</span> of borrowed gestures and shared <span style="color:#d3687e;">community</span>.
        </p>

        <p class="recipe-description">
          You are, in the truest sense, baking the <span style="color:#d3687e;">striving toward transcendence</span>.
        </p>

        <h2 class="section-title" style="font-size:1.2em;">Bake first, theorize later</h2>

        <p class="recipe-description">Scroll through the recipes, or search by keyword.</p>

        <p class="recipe-description">
          The keyword is merely <span style="color:#d3687e;">the symptom of desire</span>!
        </p>

        <p class="recipe-description">
          <a href="mailto:baking@chomp.ltd" class="email-link">baking@chomp.ltd</a>
        </p>

        <p class="recipe-description">
          <a href="https://www.chomp.ltd" class="email-link">chomp chomp: cookies, etc.</a>
        </p>
        
        <p class="recipe-description">
          <a href="https://tools.chomp.ltd" class="email-link">chomp chomp: tools</a>
        </p>
      </div>
    `;

    function resetRecipeView(){
      document.querySelectorAll('.recipe-item').forEach(i=>i.classList.remove('active'));
      document.getElementById('recipeContent').innerHTML=HOME_CONTENT_HTML;
      currentRecipe=null;
      history.replaceState(null,'',window.location.pathname);
    }

    function updateStickyIndicator(){
      const list=document.querySelector('.recipe-list-container');
      const indicator=document.getElementById('stickyIndicator');
      const topShadow=document.querySelector('.top-shadow');
      if(!list||!indicator) return;
      const scrollable=list.scrollHeight>list.clientHeight;
      if(!scrollable){
        indicator.style.display='none';
        topShadow.style.opacity=0;
        return;
      }
      indicator.style.display='block';
      const atTop=list.scrollTop<=1;
      indicator.style.opacity=atTop?1:0;
      topShadow.style.opacity=atTop?0:1;
      if(!list._scrollBound){
        list.addEventListener('scroll',()=>{
          const top=list.scrollTop<=1;
          indicator.style.opacity=top?1:0;
          topShadow.style.opacity=top?0:1;
        });
        list._scrollBound=true;
      }
    }

    function sortRecipesAlphabetically(){
      recipes.sort((a,b)=>a.title.localeCompare(b.title));
    }

    function openRecipeFromURL(){
      const params=new URLSearchParams(window.location.search);
      const slug=params.get('slug');
      if(!slug) return false;
      const recipe=recipes.find(r=>r.slug===slug);
      if(!recipe) return false;
      const list=document.getElementById('recipeList').querySelectorAll('.recipe-item');
      list.forEach(li=>{
        if(li.innerText.trim()===recipe.title){
          selectRecipe(recipe,li);
        }
      });
      return true;
    }

    async function loadRecipes(){
      const res=await fetch('recipes.json');
      recipes=await res.json();
      recipes.forEach(r=>{ if(!r.slug) r.slug=generateSlug(r.title); });
      sortRecipesAlphabetically();
      displayRecipeList(recipes);
      updateStickyIndicator();
      if(!openRecipeFromURL()) resetRecipeView();
    }

    function displayRecipeList(list){
      const container=document.getElementById('recipeList');
      const noRes=document.getElementById('noResults');
      container.innerHTML='';
      if(!list.length){ noRes.style.display='block'; return; }
      noRes.style.display='none';
      list.forEach(recipe=>{
        const li=document.createElement('li');
        li.className='recipe-item';
        li.innerHTML=`<div class="recipe-name">${recipe.title}</div>`;
        li.onclick=()=>selectRecipe(recipe,li);
        container.appendChild(li);
      });
    }

    function selectRecipe(recipe,element){
      currentRecipe=recipe;
      document.querySelectorAll('.recipe-item').forEach(i=>i.classList.remove('active'));
      element.classList.add('active');

      const meta=[];
      if(recipe.prepTime) meta.push(`<span>prep: ${recipe.prepTime}</span>`);
      if(recipe.cookTime) meta.push(`<span>cook: ${recipe.cookTime}</span>`);
      if(recipe.totalTime) meta.push(`<span>total: ${recipe.totalTime}</span>`);
      if(recipe.servings) meta.push(`<span>servings: ${recipe.servings}</span>`);
      if(recipe.source) meta.push(`<span>source: ${recipe.source}</span>`);
      if(recipe.category && recipe.category!=='null') meta.push(`<span>category: ${recipe.category}</span>`);

      let image=recipe.image?`<img src="${recipe.image}" class="recipe-image">`:'';
      let desc=recipe.description?`<div class="recipe-description">${recipe.description}</div>`:'';
      let ingredients=recipe.ingredients.map(i=>`<li class="ingredient-item">${i}</li>`).join('');
      let instructions=recipe.instructions.map(i=>`<li class="instruction-item">${i}</li>`).join('');
      let notes=recipe.notes?`<div class="section-title">notes</div><div class="notes-section">${recipe.notes}</div>`:'';

      history.replaceState(null,'',`${window.location.pathname}?slug=${recipe.slug}`);

      document.getElementById('recipeContent').innerHTML=`
        <div class="recipe-header">
          <h1 class="recipe-title">${recipe.title}</h1>
          <div class="recipe-meta">${meta.join(' | ')}</div>
          <div class="recipe-actions">
            <button onclick="printRecipe()" class="recipe-action-button">Print</button>
            <button onclick="copyPermalink()" class="recipe-action-button">Copy Link</button>
          </div>
        </div>

        ${desc}${image}

        <div class="section-title">ingredients</div>
        <ul class="ingredients-list">${ingredients}</ul>

        <div class="section-title">instructions</div>
        <ol class="instructions-list">${instructions}</ol>

        ${notes}
      `;
    }

    document.getElementById('searchBox').addEventListener('input',e=>{
      const term=e.target.value.toLowerCase();
      const filtered=recipes.filter(r=>
        r.title.toLowerCase().includes(term) ||
        (r.description && r.description.toLowerCase().includes(term)) ||
        r.ingredients.some(i=>i.toLowerCase().includes(term))
      );
      displayRecipeList(filtered);
      updateStickyIndicator();
    });

    loadRecipes();
    window.addEventListener('resize',updateStickyIndicator);
  </script>

</body>
</html>