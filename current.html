<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>chomp recipes</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    /* ---------------------------------------------------- */
    /* === BASE STYLES & LAYOUT === */
    /* ---------------------------------------------------- */

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: #fdfdfd;
      color: #434343;
      line-height: 1.7;
      display: flex;
      min-height: 100vh;
    }

    /* ---------------------------------------------------- */
    /* === SIDEBAR (LIGHT MODE DEFAULT) === */
    /* ---------------------------------------------------- */

    .sidebar {
      width: 300px;
      background-color: #f8f8f8;
      border-right: 1px solid #e0e0e0;
      overflow-y: auto;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 30px 20px 20px 20px;
      text-align: center;
      cursor: pointer;
    }

    .sidebar-title {
      font-size: 1.6em;
      font-weight: 700;
      color: #d3687e;
    }

    /* ---------------------------------------------------- */
    /* === SIDEBAR LIST === */
    /* ---------------------------------------------------- */

    .recipe-list-container {
      position: relative;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      mask-image: linear-gradient(to bottom, black 95%, transparent 100%);
      -webkit-mask-image: linear-gradient(to bottom, black 95%, transparent 100%);
    }

    .recipe-list { list-style: none; padding: 0; margin: 0; }

    .recipe-item {
      padding: 16px 20px;
      border-bottom: 1px solid #e0e0e0;
      cursor: pointer;
    }

    .recipe-item:hover { background-color: #f0f0f0; }

    .recipe-item.active {
      background-color: #d3687e;
      color: #ffffff;
    }

    .recipe-name {
      font-size: 1em;
      font-weight: 400;
      color: #9e9e9e;
    }

    .recipe-item.active .recipe-name {
      color: #ffffff !important;
    }

    .sticky-indicator {
      position: sticky;
      bottom: 0;
      text-align: center;
      padding: 8px 0;
      font-size: 0.85em;
      background: rgba(253,253,253,0.9);
      color: #777;
      display: none;
    }

    .top-shadow {
      position: sticky;
      top: 0;
      height: 24px;
      background:
        linear-gradient(to bottom, rgba(253,253,253,1), rgba(253,253,253,0)),
        linear-gradient(to bottom, rgba(0,0,0,0.15), rgba(0,0,0,0));
      pointer-events: none;
      opacity: 0;
    }

    /* ---------------------------------------------------- */
    /* === SEARCH BOX === */
    /* ---------------------------------------------------- */

    .search-box {
      width: calc(100% - 40px);
      margin: 0 20px 20px;
      padding: 12px 16px;
      border-radius: 8px;
      background: #fff;
      border: 1px solid #434343;
      font-size: 15px;
    }

    .search-box:focus {
      outline: none;
      border-color: #d3687e;
    }

    /* ---------------------------------------------------- */
    /* === MAIN CONTENT AREA === */
    /* ---------------------------------------------------- */

    .recipe-content {
      flex: 1;
      padding: 40px 60px;
      overflow-y: auto;
    }

    .recipe-header { margin-bottom: 30px; }

    .recipe-title {
      font-size: 2.1em;
      font-weight: 300;
      color: #d3687e;
      margin-bottom: 15px;
    }

    .recipe-meta {
      font-size: 0.95em;
      color: #666;
    }

    .recipe-description {
      font-size: 1em;
      line-height: 1.8;
      margin-bottom: 25px;
    }

    .recipe-image {
      display: block;
      max-width: 50%;
      margin: 0 auto 20px;
      border-radius: 8px;
    }

    /* ---------------------------------------------------- */
    /* === HOME / MANIFESTO TEXT === */
    /* ---------------------------------------------------- */

    .home-text {
      max-width: 600px;
      margin: 0 auto;
      padding: 50px 0;
      font-size: 1.05em;
      line-height: 1.85;
    }

    .home-text .home-image {
      width: 100%;
      max-width: 300px;
      margin: 0 auto 30px;
      display: block;
    }

    /* ---------------------------------------------------- */
    /* === HEADINGS & SECTIONS === */
    /* ---------------------------------------------------- */

    .section-title {
      color: #d3687e;
      font-size: 1.2em;
      font-weight: 700;
      margin: 35px 0 15px;
      text-transform: lowercase;
    }

    /* ---------------------------------------------------- */
    /* === ELEMENTS === */
    /* ---------------------------------------------------- */

    .recipe-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .recipe-action-button {
      padding: 6px 10px;
      border-radius: 4px;
      border: 1px solid #d3687e;
      color: #d3687e;
      background: transparent;
      font-size: 0.9em;
    }

    .recipe-action-button:hover {
      background: #d3687e;
      color: #fff;
    }

    .ingredients-list { list-style: none; }
    .ingredient-item {
      padding: 8px 0 8px 16px;
      border-left: 3px solid #d3687e;
    }

    .instructions-list { list-style: none; counter-reset: step-counter; }

    .instruction-item {
      padding-left: 40px;
      margin-bottom: 20px;
      position: relative;
      line-height: 1.8;
    }

    .instruction-item::before {
      content: counter(step-counter);
      counter-increment: step-counter;
      position: absolute;
      left: 0;
      top: 0;
      width: 28px;
      height: 28px;
      background: #d3687e;
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .notes-section {
      padding: 20px;
      background: #f8f8f8;
      border-radius: 8px;
      margin-top: 30px;
    }

    .no-recipe {
      text-align: center;
      padding: 20px;
      color: #666;
    }

    a.email-link {
      color: #d3687e;
      font-weight: 700;
      text-decoration: none;
    }

    /* ---------------------------------------------------- */
    /* === MOBILE OVERHAUL (LIGHT & DARK) === */
    /* ---------------------------------------------------- */

    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }

      .sidebar {
        width: 100% !important;
        max-height: 40vh !important;
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
      }

      .recipe-content {
        padding: 20px;
      }

      .recipe-image {
        max-width: 80%;
      }
    }

    /* ---------------------------------------------------- */
    /* === DARK MODE (DESKTOP + MOBILE) === */
    /* ---------------------------------------------------- */

    @media (prefers-color-scheme: dark) {

      body {
        background-color: #2a2a2a;
        color: #f5f5f5;
      }

      .recipe-content {
        background-color: #2a2a2a;
        color: #f5f5f5;
      }

      /* DESKTOP DARK MODE SIDEBAR */
      .sidebar {
        background-color: #2a2a2a !important;
        width: 300px !important;
      }

      /* MOBILE DARK MODE SIDEBAR */
      @media (max-width:768px){
        .sidebar {
          width: 100% !important;
          max-height: 40vh !important;
          background-color: #2a2a2a !important;
        }
        .recipe-name { color: #f5f5f5 !important; }
      }

      .sidebar-title,
      .recipe-name {
        color: #f5f5f5 !important;
      }

      .recipe-title,
      .section-title,
      .email-link {
        color: #d3687e !important;
      }

      .ingredient-item {
        border-left-color: #d3687e;
      }

      .instruction-item::before {
        background-color: #d3687e;
      }

      .recipe-action-button {
        border-color: #d3687e;
        color: #d3687e;
      }

      .recipe-action-button:hover {
        background-color: #d3687e;
        color: #fff;
      }
    }

  </style>
</head>

<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header" onclick="resetRecipeView()">
      <div class="sidebar-title">rituals / recipes</div>
    </div>

    <input type="text" class="search-box" id="searchBox" placeholder="search recipes...">

    <div class="recipe-list-container">
      <ul class="recipe-list" id="recipeList"></ul>
      <div class="sticky-indicator" id="stickyIndicator"></div>
      <div class="top-shadow"></div>
      <div class="no-results" id="noResults" style="display:none;">no recipes found</div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="recipe-content" id="recipeContent"></div>

  <!-- JS -->
  <script>
    let recipes = [];
    let currentRecipe = null;

    function printRecipe(){ window.print(); }

    function generateSlug(title){
      return title
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g,'')
        .replace(/\s+/g,'-')
        .replace(/-+/g,'-')
        .trim('-');
    }

    function copyPermalink(){
      if(!currentRecipe||!currentRecipe.slug) return;
      const url=`${location.origin}${location.pathname}?slug=${currentRecipe.slug}`;
      navigator.clipboard.writeText(url);
    }

    /* HOME VIEW CONTENT */
    const HOME_CONTENT = `
      <div class="home-text">
        <img src="images/Chomp Chomp logos.jpeg" class="home-image">
        <h1 class="recipe-title">Recipes & Rituals</h1>
        <h2 class="section-title">Baking as Community</h2>

        <p class="recipe-description">
          Baking is the materialization of <span style="color:#d3687e;">comfort itself</span>.
        </p>

        <p class="recipe-description">
          In this gap lies the <span style="color:#d3687e;">zen of baking</span>.
        </p>

        <p class="recipe-description">
          Baking builds a <span style="color:#d3687e;">community</span> across time.
        </p>

        <p class="recipe-description">
          You are baking the <span style="color:#d3687e;">striving toward transcendence</span>.
        </p>

        <h2 class="section-title">Bake first, theorize later</h2>

        <p class="recipe-description">
          Scroll through the recipes, or search by keyword.
        </p>

        <p class="recipe-description">
          The keyword is merely <span style="color:#d3687e;">the symptom of desire</span>.
        </p>

        <p class="recipe-description"><a href="mailto:baking@chomp.ltd" class="email-link">baking@chomp.ltd</a></p>
        <p class="recipe-description"><a href="https://www.chomp.ltd" class="email-link">chomp chomp</a></p>
        <p class="recipe-description"><a href="https://tools.chomp.ltd" class="email-link">chomp tools</a></p>
      </div>
    `;

    function resetRecipeView(){
      document.querySelectorAll('.recipe-item').forEach(el=>el.classList.remove('active'));
      document.getElementById('recipeContent').innerHTML = HOME_CONTENT;
      currentRecipe = null;
      history.replaceState(null,'',location.pathname);
    }

    function updateSticky(){
      const list=document.querySelector('.recipe-list-container');
      const indicator=document.getElementById('stickyIndicator');
      const shadow=document.querySelector('.top-shadow');
      if(list.scrollHeight <= list.clientHeight){
        indicator.style.display='none';
        shadow.style.opacity=0;
        return;
      }
      indicator.style.display='block';
      const atTop=list.scrollTop<=1;
      indicator.style.opacity=atTop?1:0;
      shadow.style.opacity=atTop?0:1;
    }

    function sortRecipes(){ recipes.sort((a,b)=>a.title.localeCompare(b.title)); }

    function openRecipeFromURL(){
      const slug=new URLSearchParams(location.search).get('slug');
      if(!slug) return false;
      const recipe=recipes.find(r=>r.slug===slug);
      if(!recipe) return false;
      document.querySelectorAll('.recipe-item').forEach(li=>{
        if(li.innerText.trim()===recipe.title){
          selectRecipe(recipe,li);
        }
      });
      return true;
    }

    async function loadRecipes(){
      const res=await fetch('recipes.json');
      recipes=await res.json();
      recipes.forEach(r=>{ if(!r.slug) r.slug=generateSlug(r.title); });
      sortRecipes();
      displayList(recipes);
      updateSticky();
      if(!openRecipeFromURL()) resetRecipeView();
    }

    function displayList(list){
      const ul=document.getElementById('recipeList');
      const noRes=document.getElementById('noResults');
      ul.innerHTML='';
      if(!list.length){ noRes.style.display='block'; return; }
      noRes.style.display='none';
      list.forEach(r=>{
        const li=document.createElement('li');
        li.className='recipe-item';
        li.innerHTML=`<div class="recipe-name">${r.title}</div>`;
        li.onclick=()=>selectRecipe(r,li);
        ul.appendChild(li);
      });
    }

    function selectRecipe(recipe, li){
      currentRecipe=recipe;
      document.querySelectorAll('.recipe-item').forEach(el=>el.classList.remove('active'));
      li.classList.add('active');

      const meta=[];
      if(recipe.prepTime)meta.push(`prep: ${recipe.prepTime}`);
      if(recipe.cookTime)meta.push(`cook: ${recipe.cookTime}`);
      if(recipe.totalTime)meta.push(`total: ${recipe.totalTime}`);
      if(recipe.servings)meta.push(`servings: ${recipe.servings}`);

      let image=recipe.image?`<img src="${recipe.image}" class="recipe-image">`:'';
      let desc=recipe.description?`<div class="recipe-description">${recipe.description}</div>`:'';
      let ingredients=recipe.ingredients.map(i=>`<li class="ingredient-item">${i}</li>`).join('');
      let instructions=recipe.instructions.map(i=>`<li class="instruction-item">${i}</li>`).join('');
      let notes=recipe.notes?`<div class="section-title">notes</div><div class="notes-section">${recipe.notes}</div>`:'';

      history.replaceState(null,'',`${location.pathname}?slug=${recipe.slug}`);

      document.getElementById('recipeContent').innerHTML=`
        <div class="recipe-header">
          <h1 class="recipe-title">${recipe.title}</h1>
          <div class="recipe-meta">${meta.join(' | ')}</div>
          <div class="recipe-actions">
            <button onclick="printRecipe()" class="recipe-action-button">Print</button>
            <button onclick="copyPermalink()" class="recipe-action-button">Copy Link</button>
          </div>
        </div>

        ${desc}${image}

        <div class="section-title">ingredients</div>
        <ul class="ingredients-list">${ingredients}</ul>

        <div class="section-title">instructions</div>
        <ol class="instructions-list">${instructions}</ol>

        ${notes}
      `;
    }

    document.getElementById('searchBox').addEventListener('input',e=>{
      const term=e.target.value.toLowerCase();
      const filtered=recipes.filter(r=>
        r.title.toLowerCase().includes(term) ||
        (r.description && r.description.toLowerCase().includes(term)) ||
        r.ingredients.some(i=>i.toLowerCase().includes(term))
      );
      displayList(filtered);
      updateSticky();
    });

    window.addEventListener('resize',updateSticky);
    loadRecipes();

  </script>
</body>
</html>