<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>chomp recipes</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    /* ---------------------------------------------------- */
    /* === BASE STYLES & LAYOUT === */
    /* ---------------------------------------------------- */

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: #fdfdfd;
      color: #434343;
      line-height: 1.7;
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 300px;
      background-color: #f5f5f5;
      border-right: 1px solid #e0e0e0;
      overflow-y: auto;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
    }

    .recipe-list-container {
      position: relative;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      flex-grow: 1;
      /* Mask for fading effect at the bottom */
      mask-image: linear-gradient(to bottom, black 95%, transparent 100%);
      -webkit-mask-image: linear-gradient(to bottom, black 95%, transparent 100%);
    }

    .sidebar-header {
      padding: 30px 20px 20px 20px;
      text-align: center;
      cursor: pointer;
      flex-shrink: 0;
    }

    .sidebar-title {
      font-size: 1.6em;
      font-weight: 300;
      color: #e73b42;
      flex-shrink: 0;
    }

    /* ---------------------------------------------------- */
    /* === SEARCH & LIST ITEMS === */
    /* ---------------------------------------------------- */

    .search-box {
      width: calc(100% - 40px);
      margin: 0 20px 20px 20px;
      padding: 12px 16px;
      font-size: 15px;
      font-family: 'Inter', sans-serif;
      border: 1px solid #434343;
      border-radius: 8px;
      background-color: #ffffff;
      color: #434343;
      flex-shrink: 0;
    }

    .search-box:focus { outline: none; border-color: #e73b42; }

    .recipe-list { list-style: none; padding: 0; margin: 0; }

    .recipe-item {
      padding: 16px 20px;
      cursor: pointer;
      border-bottom: 1px solid #e0e0e0;
      transition: background-color 0.2s;
      color: #9e9e9e;
    }

    .recipe-item:last-child { border-bottom: none; }

    .recipe-item:hover { background-color: #f0f0f0; }

    .recipe-item.active {
      background-color: #e73b42;
      color: #ffffff;
    }

    .recipe-name {
      font-weight: 400;
      font-size: 1em;
    }

    .recipe-item.active .recipe-time { color: rgba(255, 255, 255, 0.8); }

    /* Sticky Indicator and Shadow */
    .sticky-indicator {
      position: sticky;
      bottom: 0;
      text-align: center;
      background: rgba(253,253,253,0.9);
      padding: 8px 0;
      font-size: 0.85em;
      color: #777;
      opacity: 1;
      transition: opacity 0.3s ease;
      display: none;
    }

    .top-shadow {
      position: sticky;
      top: 0;
      width: 100%;
      height: 24px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.25s ease;
      background:
        linear-gradient(to bottom,
          rgba(253,253,253,1) 0%,
          rgba(253,253,253,0) 90%),
        linear-gradient(to bottom,
          rgba(0,0,0,0.15),
          rgba(0,0,0,0));
    }


    /* ---------------------------------------------------- */
    /* === RECIPE CONTENT === */
    /* ---------------------------------------------------- */

    .recipe-content {
      flex: 1;
      overflow-y: auto;
      padding: 50px 0px;
      max-width: 600px;
    }

    .recipe-header { margin-bottom: 20px; }

    .recipe-title {
      font-size: 2.1em;
      font-weight: 300;
      color: #e73b42;
      margin-bottom: 15px;
      line-height: 1.2;
    }

    .recipe-meta {
      color: #666666;
      font-size: 0.95em;
      margin-bottom: 10px;
    }
    .recipe-meta span { margin-right: 0 !important; }

    /* Base styles for description (used for both recipe and manifesto) */
    .recipe-description {
      font-weight: 300;
      line-height: 1.8;
      margin-bottom: 25px;
      font-size: 1em;
    }

    .recipe-image {
      display: block;
      max-width: 50%;
      width: auto;
      height: auto;
      border-radius: 8px;
      margin: 0 auto 20px auto;
    }

    /* ---------------------------------------------------- */
    /* === HOME / MANIFESTO TEXT (CONSOLIDATED) === */
    /* ---------------------------------------------------- */
    
    .home-text {
      text-align: left;
      padding: 50px 0;
      max-width: 600px;
      margin: 0 auto;
      font-size: 1.05em; /* Specific size for home page body text */
      font-family: 'Inter', sans-serif;
      line-height: 1.85;
    }

    .home-text .home-image {
      width: 100%;
      max-width: 300px;
      height: auto;
      margin-bottom: 30px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .home-text .recipe-title {
      font-weight: 700 !important;
    }

    .manifesto-title .manifesto-line-1 {
      font-weight: 700 !important;
      font-weight: 500;
    }

    .home-text,
    .home-text .recipe-description {
      color: #1a1a1a !important; /* Specific color for home text */
      font-size: 1em !important;
      line-height: 1.9 !important;
    }

    /* ---------------------------------------------------- */
    /* === ACTIONS & SECTIONS === */
    /* ---------------------------------------------------- */

    .recipe-actions {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    .recipe-action-button {
      font-family: 'Inter', sans-serif !important;
      font-size: 0.95em;
      padding: 6px 10px;
      background: transparent;
      border: 1px solid #E73B42;
      color: #E73B42;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .recipe-action-button:hover {
      background-color: #E73B42;
      color: white;
    }

    /* Print Button (Legacy, now using recipe-action-button) */
    .print-button {
      padding: 10px 15px;
      font-size: 16px;
      background-color: #E73B42;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 0;
      transition: background-color 0.2s;
    }

    .print-button:hover { background-color: #c90028; }

    .copy-link-button {
      background: none;
      border: none;
      padding: 0;
      font-size: 0.9em;
      color: #666666;
      cursor: pointer;
      text-decoration: underline;
    }

    .copy-link-button:hover { color: #E73B42; }

    .section-title {
      color: #E73B42;
      font-size: 1.2em;
      font-weight: 700;
      margin: 35px 0 15px 0;
    }

    .ingredients-list { list-style: none; margin-bottom: 30px; }

    .ingredient-item {
      padding: 8px 0 8px 16px;
      border-left: 3px solid #E73B42;
      margin-bottom: 8px;
      font-weight: 300;
    }

    .instructions-list { list-style: none; counter-reset: step-counter; }

    .instruction-item {
      counter-increment: step-counter;
      margin-bottom: 20px;
      padding-left: 40px;
      position: relative;
      font-weight: 300;
      line-height: 1.8;
    }

    .instruction-item::before {
      content: counter(step-counter);
      position: absolute;
      left: 0;
      top: 0;
      width: 28px;
      height: 28px;
      background-color: #E73B42;
      color: #ffffff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 400;
      font-size: 0.9em;
    }

    .notes-section {
      background-color: #f8f8f8;
      padding: 20px;
      border-radius: 8px;
      margin-top: 30px;
      font-weight: 300;
    }

    .no-recipe {
      padding: 20px;
      text-align: center;
      color: #666666;
      font-size: 0.95em;
    }

    a.email-link { color: #E73B42; font-weight: 700; text-decoration: none; }

    /* ---------------------------------------------------- */
    /* === MEDIA QUERIES === */
    /* ---------------------------------------------------- */

    @media (max-width: 768px) {
      .recipe-list-container { max-height: calc(56px * 3); }
      body { flex-direction: column; }
      .sidebar { 
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
        max-height: 40vh;
      }
      .recipe-content { padding: 20px; }
      .recipe-image { max-width: 80%; }
    }

    @media print {
      .sidebar, .search-box, .print-button, .copy-link-button, .sidebar-header, .recipe-list-container, .recipe-actions, .recipe-action-button {
        display: none !important;
      }
      body { display: block; min-height: auto; color: #000000; }
      .recipe-content { width: 100%; max-width: 100%; margin: 0; padding: 0; }
      .recipe-title { color: #000000 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .recipe-meta, .recipe-description { color: #333333; }
      .section-title { color: #333333 !important; }
      .notes-section { background-color: transparent; border: 1px dashed #cccccc; }
      .ingredient-item { border-left-color: #cccccc !important; }
      .instruction-item::before { background-color: #000000 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }



    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header" onclick="resetRecipeView()" style="cursor: pointer;">
      <div class="sidebar-title">rituals / recipes</div>
    </div>
    <input type="text" class="search-box" id="searchBox" placeholder="search recipes...">
    
    <div class="recipe-list-container">
        <ul class="recipe-list" id="recipeList"></ul>
        <div id="stickyIndicator" class="sticky-indicator"></div>
        <div class="top-shadow"></div>
        <div class="no-results" id="noResults" style="display: none;">no recipes found</div>
    </div>
  </div>

  <div class="recipe-content" id="recipeContent"></div>

  <script>
    let recipes = [];
    let currentRecipe = null;
    
    function printRecipe() { window.print(); }

    function generateSlug(title) {
      return title
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '') // Keep alphanumeric, space, and hyphen
        .replace(/\s+/g, '-') // Replace spaces with a single hyphen
        .replace(/-+/g, '-') // Replace multiple hyphens with a single one
        .trim('-'); // Remove leading/trailing hyphens/whitespace
    }

    // Function to copy the permalink of the currently viewed recipe
    function copyPermalink() {
        if (!currentRecipe || !currentRecipe.slug) return;
        const url = `${window.location.origin}${window.location.pathname}?slug=${encodeURIComponent(currentRecipe.slug)}`;
        navigator.clipboard.writeText(url).then(() => {
            alert('Permalink copied to clipboard!');
        }).catch(err => {
            console.error('Could not copy text: ', err);
        });
    }

    const HOME_CONTENT_HTML = `
      <div class="home-text">
          <img src="images/Chomp Chomp logos.jpeg" alt="Chomp Recipes Logo" class="home-image">
          <h1 class="recipe-title" style="font-size:2em;">Recipes & Rituals</h1>
          <h2 class="section-title manifesto-title" style="font-size:1.2em;">
            <span class="manifesto-line-1">A Baking Manifesto</span>
          </h2>

 
          <p class="recipe-description">
          Baking. What is baking, <em>really</em>? It is not simply the combination of flour, sugar, butter, and eggs.
          No: this would be far too naïve. Baking is the materialization of <span style="color:#d3687e;">comfort itself</span>.
          When we bake, we engage in a ritual that attempts to suspend the chaos of the world through the illusion of control: precise measurements, preheated ovens, perfectly timed rotations of trays.
          And yet, as any baker knows, this control is always incomplete. The cake may rise, or it may collapse;
          the dough may refuse to proof. The oven, that domestic abyss, stares back.
          </p>

          <p class="recipe-description">
          But in this gap (between intention and outcome) lies the <span style="color:#d3687e;">zen of baking</span>.
          We submit ourselves to a process that resists total mastery. The mind quiets as the hands work.
          The self dissolves into the rhythm of kneading, folding, and whisking.
          In baking, the most mundane gestures become philosophical: the transformation of raw matter into something tender, fragrant, <span style="color:#d3687e;">shareable</span>.
          Is this not, in a way, an allegory of all human creation?
          We impose form upon chaos, and call it dessert.
          </p>

          <p class="recipe-description">
          Culturally, baking binds us in a way that predates language.
          Across centuries and continents, <span style="color:#d3687e;">the act of sharing</span> bread, cake, or cookie functions as a social contract - a small edible utopia.
          You offer someone a slice, a biscuit, a still-warm loaf, and for a fleeting moment the alienation of modern life is suspended.
          Even the recipes themselves - whether original inventions, found online, or passed from one colleague's grandmother to another's notebook - form a <span style="color:#d3687e;">network</span> of borrowed gestures and shared <span style="color:#d3687e;">community</span>.
          </p>

          <p class="recipe-description">
          So, as you explore these recipes, remember: you are not merely reproducing instructions.
          You are reenacting an ancient dialectic between chaos and order, solitude and <span style="color:#d3687e;">community</span>, scarcity and indulgence.
          You are, in the truest sense, baking the <span style="color:#d3687e;">striving toward transcendence</span>.
          </p>

          <h2 class="section-title" style="font-size:1.2em;">Bake first, theorize later</h2>

          <p class="recipe-description">
          Scroll through the recipes, or search by keyword.
          </p>

          <p class="recipe-description">
          Of course, as with all things in life, the search itself may be more revealing than the finding—the keyword is merely <span style="color:#d3687e;">the symptom of desire</span>!
          </p>

          <p class="recipe-description">
          Because baking, like theory, thrives on exchange and variation, I'm always looking for something new.
          If you have a recipe - your grandmother's secret torte, your own <span style="color:#d3687e;">subversive</span> take on the cookie, or something you found in a forgotten corner of the internet - please send it to me.
          I'll add it here, with full credit, so that our <span style="color:#d3687e;">collective archive</span> of baked transcendence may continue to grow.
          </p>

          <p class="recipe-description">
          <a href="mailto:baking@chomp.ltd" class="email-link">baking@chomp.ltd</a>
          </p>
  
          <p class="recipe-description">
          <a href="https://www.chomp.ltd" class="email-link">chomp chomp: cookies, etc.</a>
          </p>
   
          <p class="recipe-description">
          <a href="https://tools.chomp.ltd" class="email-link">chomp chomp: tools</a>
          </p> 
      </div>
    `;

    function resetRecipeView() {
        document.querySelectorAll('.recipe-item').forEach(item => item.classList.remove('active'));
        document.getElementById('recipeContent').innerHTML = HOME_CONTENT_HTML;
        currentRecipe = null;
        // Reset URL when going back to home view
        history.replaceState(null, '', window.location.pathname);
    }

    function updateStickyIndicator() {
      const list = document.querySelector('.recipe-list-container');
      const indicator = document.getElementById('stickyIndicator');
      const topShadow = document.querySelector('.top-shadow');
      if (!list || !indicator) return;

      const isScrollable = list.scrollHeight > list.clientHeight;
      if (!isScrollable) {
        indicator.style.display = 'none';
        if (topShadow) topShadow.style.opacity = 0;
        return;
      }

      indicator.style.display = 'block';
      const isMobile = window.innerWidth < 768;
      indicator.textContent = isMobile ?
        "↓ scroll for more" : "↓ scroll for more recipes";

      const atTop = list.scrollTop <= 1;
      indicator.style.opacity = atTop ? 1 : 0;
      if (topShadow) topShadow.style.opacity = atTop ? 0 : 1;
      
      if (!list._hasStickyScrollHandler) {
        list.addEventListener('scroll', () => {
          const nowAtTop = list.scrollTop <= 1;
          indicator.style.opacity = nowAtTop ? 1 : 0;
          if (topShadow) {
            topShadow.style.opacity = nowAtTop ? 0 : 1;
          }
        });
        list._hasStickyScrollHandler = true;
      }
    }

    function sortRecipesAlphabetically() {
      recipes.sort((a,b)=>
        a.title.toLowerCase() < b.title.toLowerCase() ? -1 :
        a.title.toLowerCase() > b.title.toLowerCase() ? 1 : 0
      );
    }

    function openRecipeFromURL() {
      const params = new URLSearchParams(window.location.search);
      const slugParam = params.get('slug');
      const titleParam = params.get('recipe');

      if ((!slugParam || slugParam.trim() === '') && !titleParam) return false;
      let target = null;

      if (slugParam && slugParam.trim() !== '') {
        target = recipes.find(r => r.slug === slugParam.trim());
      } else if (titleParam) {
        const lower = titleParam.toLowerCase();
        target = recipes.find(r => r.title.toLowerCase() === lower);
      }

      if (!target) return false;
      const recipeList = document.getElementById('recipeList');
      const items = recipeList.querySelectorAll('.recipe-item');

      items.forEach(item => {
        const nameEl = item.querySelector('.recipe-name');
        if (nameEl && nameEl.textContent.trim() === target.title) {
          selectRecipe(target, item);
        }
      });
      return true;
    }

    async function loadRecipes() {
      try {
        const response = await fetch('recipes.json');
        recipes = await response.json();

        // ensure every recipe has a slug (fallback)
        recipes.forEach(r => {
          if (!r.slug) {
            r.slug = generateSlug(r.title);
          }
        });
        
        sortRecipesAlphabetically();
        displayRecipeList(recipes);
        updateStickyIndicator(); 

        if (!openRecipeFromURL()) {
          resetRecipeView();
        }
      } catch (error) { 
        console.error('Error loading recipes:', error);
        // Display fallback message if recipes fail to load
        document.getElementById('recipeContent').innerHTML = `
            <div class="no-recipe">
                <p>Unable to load recipes. Please check the 'recipes.json' file path and content.</p>
            </div>
        `;
      }
    }

    function displayRecipeList(recipesToShow) {
      const recipeList = document.getElementById('recipeList');
      const noResults = document.getElementById('noResults');
      recipeList.innerHTML = '';
      if (!recipesToShow.length) { 
        noResults.style.display = 'block'; 
        return;
      }
      noResults.style.display = 'none';
      recipesToShow.forEach(recipe => {
        const li = document.createElement('li');
        li.className = 'recipe-item';
        li.onclick = () => selectRecipe(recipe, li);
        li.innerHTML = `<div class="recipe-name">${recipe.title}</div>`;
        
        // Retain 'active' class if this recipe is the one currently selected
        if (currentRecipe && currentRecipe.slug === recipe.slug) {
            li.classList.add('active');
        }

        recipeList.appendChild(li);
      });
    }

    function selectRecipe(recipe, element) {
      currentRecipe = recipe;
      document.querySelectorAll('.recipe-item').forEach(item=>item.classList.remove('active'));
      element.classList.add('active');
      const content = document.getElementById('recipeContent');

      let metaInfo = [];
      if (recipe.prepTime) metaInfo.push(`<span>prep: ${recipe.prepTime}</span>`);
      if (recipe.cookTime) metaInfo.push(`<span>cook: ${recipe.cookTime}</span>`);
      if (recipe.totalTime) metaInfo.push(`<span>total: ${recipe.totalTime}</span>`);
      if (recipe.servings) metaInfo.push(`<span>servings: ${recipe.servings}</span>`);
      if (recipe.source) metaInfo.push(`<span>source: ${recipe.source}</span>`);
      if (recipe.category && recipe.category !== 'null') metaInfo.push(`<span>category: ${recipe.category}</span>`);

      let imageHTML = recipe.image?`<img src="${recipe.image}" alt="${recipe.title}" class="recipe-image">`:'';
      let descriptionHTML = recipe.description?`<div class="recipe-description">${recipe.description}</div>`:'';
      const ingredientsHTML = recipe.ingredients.map(i=>`<li class="ingredient-item">${i}</li>`).join('');
      const instructionsHTML = recipe.instructions.map(i=>`<li class="instruction-item">${i}</li>`).join('');
      let notesHTML = recipe.notes?`<div class="section-title">notes</div><div class="notes-section">${recipe.notes}</div>`:'';

      // update URL to current recipe slug
      if (recipe.slug) {
        const newUrl = `${window.location.pathname}?slug=${encodeURIComponent(recipe.slug)}`;
        history.replaceState(null, '', newUrl);
      }

      content.innerHTML = `
        <div class="recipe-header">
          <h1 class="recipe-title">${recipe.title}</h1>
          <div class="recipe-meta">${metaInfo.join(' | ')}</div>
          <div class="recipe-actions">
            <button onclick="printRecipe()" class="recipe-action-button">Print</button>
            <button onclick="copyPermalink()" class="recipe-action-button">Copy Link</button>
          </div>
      
        </div>
        ${descriptionHTML}${imageHTML}
        <div class="section-title">ingredients</div>
        <ul class="ingredients-list">${ingredientsHTML}</ul>
        <div class="section-title">instructions</div>
        <ol class="instructions-list">${instructionsHTML}</ol>
        ${notesHTML}
      `;
    }

    // ----------------------------------------------------
    // === INITIALIZATION & EVENT LISTENERS ===
    // ----------------------------------------------------

    document.getElementById('searchBox').addEventListener('input', e=>{
      const searchTerm = e.target.value.toLowerCase();
      const filtered = recipes.filter(r=>
        r.title.toLowerCase().includes(searchTerm) ||
        (r.description&&r.description.toLowerCase().includes(searchTerm)) ||
        r.ingredients.some(i=>i.toLowerCase().includes(searchTerm))
      );
      displayRecipeList(filtered);
      updateStickyIndicator();
    });
    
    // Load data and set up initial view
    loadRecipes();
    
    // Update sticky indicator on resize
    window.addEventListener('resize', () => {
      updateStickyIndicator();
    });

  </script>
</body>
</html>