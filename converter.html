<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recipe to JSON Converter v3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --bg: #f4f7f6;
            --panel: #ffffff;
            --border: #e0e0e0;
            --accent: #fe0032;
            --accent-soft: #ffe3ea;
            --text-main: #333333;
            --text-muted: #777777;
            --code-bg: #f0f0f0;
            --danger: #b00020;
            --success: #1b7f3b;
            --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            --sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: var(--sans);
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg);
            color: var(--text-main);
        }

        h1 {
            color: var(--text-main);
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
            margin-bottom: 16px;
            font-size: 1.8rem;
            letter-spacing: -0.02em;
        }

        h1 span.tag {
            font-size: 0.7em;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--accent);
            margin-left: 8px;
        }

        .layout {
            display: grid;
            grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
            gap: 18px;
        }

        .panel {
            background-color: var(--panel);
            border-radius: 10px;
            padding: 14px 16px 16px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
            border: 1px solid rgba(0,0,0,0.03);
        }

        .panel h2 {
            font-size: 1rem;
            margin: 0 0 8px;
            display: flex;
            align-items: baseline;
            gap: 6px;
        }

        .panel h2 span.sub {
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--text-muted);
        }

        .hint {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0 0 10px;
        }

        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            font-size: 0.82rem;
            color: #555;
        }

        label span.req {
            color: var(--accent);
            margin-left: 2px;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 8px 9px;
            margin-bottom: 10px;
            border: 1px solid #cccccc;
            border-radius: 4px;
            font-size: 0.86rem;
            font-family: var(--sans);
            background-color: #fafafa;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 1px rgba(254,0,50,0.18);
            background-color: #ffffff;
        }

        .field-row {
            display: grid;
            grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.8fr);
            gap: 8px;
        }

        .field-inline {
            display: flex;
            gap: 8px;
        }

        .field-inline > div {
            flex: 1;
        }

        .array-field-group {
            border: 1px solid var(--border);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            background: #fafafa;
        }

        .array-field-group label {
            margin-bottom: 4px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 4px;
        }

        button {
            padding: 7px 12px;
            border-radius: 4px;
            border: 1px solid var(--accent);
            background-color: #ffffff;
            color: var(--accent);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            letter-spacing: 0.03em;
            text-transform: uppercase;
        }

        button.primary {
            background-color: var(--accent);
            color: #ffffff;
        }

        button.subtle {
            border-color: #cccccc;
            color: #444;
        }

        button:disabled {
            opacity: 0.6;
            cursor: default;
        }

        button:hover:not(:disabled) {
            background-color: var(--accent-soft);
        }

        button.primary:hover:not(:disabled) {
            background-color: #ff325b;
        }

        #jsonOutput {
            background-color: var(--code-bg);
            border-radius: 6px;
            padding: 10px;
            min-height: 220px;
            white-space: pre-wrap;
            font-family: var(--mono);
            font-size: 0.8rem;
            color: #202020;
            border: 1px dashed #bdbdbd;
        }

        .status-line {
            margin-top: 6px;
            font-size: 0.78rem;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
            gap: 8px;
            align-items: center;
        }

        .status-line span.flag-ok {
            color: var(--success);
            font-weight: 600;
        }

        .status-line span.flag-bad {
            color: var(--danger);
            font-weight: 600;
        }

        .status-line span.small {
            font-size: 0.72rem;
        }

        /* Preview panel */
        #previewContainer {
            margin-top: 8px;
            border-radius: 6px;
            border: 1px solid var(--border);
            padding: 10px;
            background: #fafafa;
            max-height: 360px;
            overflow: auto;
        }

        #previewContainer.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 0.8rem;
            font-style: italic;
        }

        .preview-title {
            font-size: 1.05rem;
            margin: 0 0 4px;
            color: var(--accent);
            letter-spacing: -0.01em;
        }

        .preview-meta {
            font-size: 0.78rem;
            color: #666;
            margin-bottom: 8px;
        }
        .preview-meta span + span::before {
            content: " | ";
            margin: 0 3px;
            color: #aaaaaa;
        }

        .preview-description {
            font-size: 0.86rem;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .preview-section-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            margin: 10px 0 4px;
            color: #555;
            font-weight: 700;
        }

        .preview-ingredients,
        .preview-instructions {
            margin: 0;
            padding-left: 18px;
        }

        .preview-ingredients li,
        .preview-instructions li {
            font-size: 0.84rem;
            margin-bottom: 3px;
        }

        .preview-notes {
            font-size: 0.8rem;
            margin-top: 6px;
            padding: 6px 8px;
            border-radius: 4px;
            background-color: #fffdf7;
            border: 1px dashed #e0c89b;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.74rem;
            padding: 2px 6px;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: #fafafa;
        }

        .badge span.dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #999;
        }

        .badge.ok span.dot {
            background: var(--success);
        }

        .badge.warn span.dot {
            background: #f5a623;
        }

        .badge.bad span.dot {
            background: var(--danger);
        }

        .inline-note {
            font-size: 0.76rem;
            color: var(--text-muted);
        }

        @media (max-width: 880px) {
            .layout {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        @media (max-width: 600px) {
            body {
                padding: 12px;
            }
            h1 {
                font-size: 1.4rem;
            }
            .panel {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <h1>
        üç≤ Recipe to JSON Converter
        <span class="tag">chomp.ltd</span>
    </h1>
    <p class="hint" style="margin-bottom:14px;">
        Paste a Markdown recipe, tweak the fields, then generate validated JSON for your <code style="font-family:var(--mono); background:rgba(0,0,0,0.04); padding:1px 4px; border-radius:3px;">recipes.json</code>. 
        Slugs are optional but recommended for permalinks.
    </p>

    <div class="panel" style="margin-bottom:16px;">
        <h2>Markdown Parser <span class="sub">optional shortcut</span></h2>
        <p class="hint">
            Paste your full <strong>.md</strong> recipe here. The parser looks for:
            <span class="inline-note">title (<code>#</code>), description &amp; metadata, <code>## Ingredients</code>, <code>## Instructions</code>, and <code>## Notes</code>.</span>
            It will also pick up simple metadata lines like <code>Servings: 8</code> or <code>Slug: my-recipe</code>.
        </p>
        <textarea id="markdownInput" rows="7" placeholder="# Recipe Title

Description paragraph.

Servings: 6
Prep: 15 minutes
Cook: 45 minutes
Slug: my-recipe-slug

## Ingredients
- ingredient 1
- ingredient 2

## Instructions
1. Step one
2. Step two

## Notes
Any notes here."></textarea>
        <div class="controls">
            <button type="button" class="primary" onclick="parseMarkdown()">Parse Markdown ‚Üí Fill Fields</button>
            <button type="button" class="subtle" onclick="clearMarkdown()">Clear Markdown</button>
        </div>
        <p class="hint" style="margin-top:6px;">
            After parsing, review and adjust the fields below. Links you type (like <code>[text](https://example.com)</code>) are preserved as-is in JSON.
        </p>
    </div>

    <div class="layout">
        <!-- LEFT: Fields -->
        <div class="panel">
            <h2>Recipe Fields <span class="sub">single recipe object</span></h2>
            <form id="recipeForm" onsubmit="return false;">
                <label for="title">Title <span class="req">*</span></label>
                <input type="text" id="title" required placeholder="e.g. Ube Br√ªl√©e">

                <div class="field-row">
                    <div>
                        <label for="slug">Slug <span class="req">*</span></label>
                        <input type="text" id="slug" placeholder="auto-generated-from-title" aria-describedby="slugHelp">
                    </div>
                    <div>
                        <label for="category">Category</label>
                        <input type="text" id="category" placeholder="e.g. chomp chomp, cake, cookies">
                    </div>
                </div>
                <p id="slugHelp" class="hint" style="margin-top:-4px; margin-bottom:8px;">
                    Used for permalinks. Auto-fills from title; you can override or leave blank to omit.
                </p>

                <label for="description">Description</label>
                <textarea id="description" placeholder="Short intro or description. Markdown-style links like [source](https://...) are okay."></textarea>

                <div class="field-row">
                    <div>
                        <label for="servings">Servings</label>
                        <input type="text" id="servings" placeholder="e.g. 12 cookies">
                    </div>
                    <div>
                        <label for="source">Source</label>
                        <input type="text" id="source" placeholder="e.g. NYT, cookbook title, friend">
                    </div>
                </div>

                <div class="field-row">
                    <div>
                        <label for="prepTime">Prep Time</label>
                        <input type="text" id="prepTime" placeholder="e.g. 15min">
                    </div>
                    <div>
                        <label for="cookTime">Cook Time</label>
                        <input type="text" id="cookTime" placeholder="e.g. 45-60 minutes">
                    </div>
                </div>

                <label for="totalTime">Total Time</label>
                <input type="text" id="totalTime" placeholder="Optional; can be free-form like ‚Äú2 hours‚Äù or ‚Äú1h 45min‚Äù.">

                <label for="image">Image Path</label>
                <input type="text" id="image" placeholder="e.g. images/ube-brulee.jpg (leave blank for null)">

                <div class="array-field-group">
                    <label for="ingredients">Ingredients <span class="req">*</span></label>
                    <p class="hint">One ingredient or subheading per line (e.g. <code>### Cookies</code> for grouped sections).</p>
                    <textarea id="ingredients" required placeholder="e.g.
### Cookies
2 cups flour
1 cup sugar

### Glaze
1 cup powdered sugar
2 tbsp lemon juice"></textarea>
                </div>

                <div class="array-field-group">
                    <label for="instructions">Instructions <span class="req">*</span></label>
                    <p class="hint">One step per line. Numbers / bullets are stripped automatically.</p>
                    <textarea id="instructions" required placeholder="e.g.
Preheat the oven to 350¬∞F.
Whisk together dry ingredients.
Fold in wet ingredients and bake."></textarea>
                </div>

                <label for="notes">Notes</label>
                <textarea id="notes" placeholder="Storage tips, substitutions, doubling notes, etc."></textarea>

                <div class="controls" style="margin-top:6px;">
                    <button type="button" class="primary" onclick="generateJson()">Generate JSON</button>
                    <button type="button" onclick="validateJson()">Validate JSON</button>
                    <button type="button" class="subtle" onclick="clearForm()">Clear Fields</button>
                </div>
            </form>
        </div>

        <!-- RIGHT: JSON + Preview -->
        <div class="panel">
            <h2>JSON Output &amp; Preview <span class="sub">ready for recipes.json</span></h2>
            <p class="hint">
                Copy the object below into your main <code>recipes.json</code> array. The output is already valid JSON (no trailing commas).
            </p>
            <pre id="jsonOutput"></pre>
            <div class="status-line">
                <span id="validationStatus" class="small">No JSON generated yet.</span>
                <div style="display:flex; gap:6px;">
                    <button type="button" id="copyButton" onclick="copyToClipboard()" disabled>Copy JSON</button>
                    <button type="button" onclick="showPreview()">Preview</button>
                </div>
            </div>

            <div id="previewContainer" class="empty">
                <span>No preview yet. Generate JSON, then click ‚ÄúPreview‚Äù.</span>
            </div>
        </div>
    </div>

    <script>
        // --- Helper: Convert newline-separated text to array of trimmed lines ---
        function toArray(text) {
            if (!text) return [];
            return text
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
        }

        // --- Helper: normalize keys in metadata lines ---
        function normalizeKey(key) {
            if (!key) return null;
            const map = {
                'servings': 'servings',
                'prep': 'prepTime',
                'preptime': 'prepTime',
                'cook': 'cookTime',
                'cooktime': 'cookTime',
                'total': 'totalTime',
                'totaltime': 'totalTime',
                'source': 'source',
                'image': 'image',
                'category': 'category',
                'slug': 'slug'
            };
            const normalized = key.toLowerCase().replace(/[^a-z0-9]/g, '');
            return map[normalized] || null;
        }

        // --- Slug generation ---
        function makeSlug(str) {
            return (str || '')
                .toLowerCase()
                .normalize('NFD')
                .replace(/[^\w\s-]/g, '')
                .trim()
                .replace(/[\s_]+/g, '-')
                .replace(/-+/g, '-');
        }

        function autoUpdateSlug() {
            const titleInput = document.getElementById('title');
            const slugInput = document.getElementById('slug');
            const currentSlug = slugInput.value.trim();
            const autoFlag = slugInput.dataset.autoGenerated === 'true';

            if (!currentSlug || autoFlag) {
                const newSlug = makeSlug(titleInput.value);
                slugInput.value = newSlug;
                slugInput.dataset.autoGenerated = 'true';
            }
        }

        function markSlugAsManual() {
            const slugInput = document.getElementById('slug');
            slugInput.dataset.autoGenerated = 'false';
        }

        document.getElementById('title').addEventListener('input', autoUpdateSlug);
        document.getElementById('slug').addEventListener('input', markSlugAsManual);

        // --- Markdown Parsing ---
        function parseMarkdown() {
            const mdText = document.getElementById('markdownInput').value;
            if (!mdText.trim()) {
                alert("Please paste your Markdown recipe content first.");
                return;
            }

            const lines = mdText.split('\n');
            let section = 'title';
            let description = [];
            let metadata = {};
            let ingredients = [];
            let instructions = [];
            let notes = [];
            let title = '';

            for (const rawLine of lines) {
                const line = rawLine.replace(/\r$/, '');
                const trimmedLine = line.trim();

                // Section headers
                if (trimmedLine.startsWith('# ')) {
                    title = trimmedLine.substring(2).trim();
                    section = 'description';
                    continue;
                } else if (/^##\s+ingredients/i.test(trimmedLine)) {
                    section = 'ingredients';
                    continue;
                } else if (/^##\s+instructions/i.test(trimmedLine)) {
                    section = 'instructions';
                    continue;
                } else if (/^##\s+notes/i.test(trimmedLine)) {
                    section = 'notes';
                    continue;
                }

                if (trimmedLine === '') {
                    continue;
                }

                if (section === 'description') {
                    // Metadata lines: Key: Value
                    const metaMatch = trimmedLine.match(/^([A-Za-z\s]+):\s*(.+)$/);
                    if (metaMatch) {
                        const key = normalizeKey(metaMatch[1].trim());
                        const value = metaMatch[2].trim();
                        if (key) {
                            metadata[key] = value;
                        } else {
                            description.push(trimmedLine);
                        }
                    } else {
                        description.push(trimmedLine);
                    }
                } else if (section === 'ingredients') {
                    const cleaned = trimmedLine.replace(/^[\*\-\d\.)]+\s*/, '').trim();
                    ingredients.push(cleaned);
                } else if (section === 'instructions') {
                    const cleaned = trimmedLine.replace(/^[\*\-\d\.)]+\s*/, '').trim();
                    instructions.push(cleaned);
                } else if (section === 'notes') {
                    notes.push(trimmedLine);
                }
            }

            // Populate fields
            document.getElementById('title').value = title || '';
            document.getElementById('description').value = description.join('\n').trim() || '';
            document.getElementById('servings').value = metadata.servings || '';
            document.getElementById('prepTime').value = metadata.prepTime || '';
            document.getElementById('cookTime').value = metadata.cookTime || '';
            document.getElementById('totalTime').value = metadata.totalTime || '';
            document.getElementById('source').value = metadata.source || '';
            document.getElementById('image').value = metadata.image || '';
            document.getElementById('category').value = metadata.category || '';

            // slug from metadata, else auto from title
            const slugInput = document.getElementById('slug');
            if (metadata.slug) {
                slugInput.value = metadata.slug.trim();
                slugInput.dataset.autoGenerated = 'false';
            } else {
                slugInput.value = makeSlug(title);
                slugInput.dataset.autoGenerated = 'true';
            }

            document.getElementById('ingredients').value = ingredients.join('\n');
            document.getElementById('instructions').value = instructions.join('\n');
            document.getElementById('notes').value = notes.join('\n').trim() || '';

            generateJson();
            setStatus("Markdown parsed. Fields filled from file.", true);
        }

        function clearMarkdown() {
            document.getElementById('markdownInput').value = '';
        }

        // --- JSON Generation ---
        function generateJson() {
            const form = document.getElementById('recipeForm');
            const output = document.getElementById('jsonOutput');
            const copyBtn = document.getElementById('copyButton');

            if (!form.checkValidity()) {
                output.textContent = "ERROR: Missing required fields (Title, Ingredients, Instructions).";
                copyBtn.disabled = true;
                setStatus("Fix required fields before copying.", false);
                return;
            }

            const recipe = {
                "title": document.getElementById('title').value.trim() || null,
                "slug": (document.getElementById('slug').value.trim() || null),
                "description": document.getElementById('description').value.trim() || null,
                "servings": document.getElementById('servings').value.trim() || null,
                "prepTime": document.getElementById('prepTime').value.trim() || null,
                "cookTime": document.getElementById('cookTime').value.trim() || null,
                "totalTime": document.getElementById('totalTime').value.trim() || null,
                "source": document.getElementById('source').value.trim() || null,
                "image": document.getElementById('image').value.trim() || null,
                "category": document.getElementById('category').value.trim() || null,
                "ingredients": toArray(document.getElementById('ingredients').value),
                "instructions": toArray(document.getElementById('instructions').value),
                "notes": document.getElementById('notes').value.trim() || null
            };

            // Normalize empty arrays
            if (!recipe.ingredients.length) recipe.ingredients = [];
            if (!recipe.instructions.length) recipe.instructions = [];

            const jsonString = JSON.stringify(recipe, null, 2);
            output.textContent = jsonString;
            copyBtn.disabled = false;
            setStatus("JSON generated. You can now validate, copy, and preview.", true);
        }

        // --- Validation ---
        function validateJson() {
            const raw = document.getElementById('jsonOutput').textContent.trim();
            if (!raw) {
                alert("No JSON to validate. Click Generate JSON first.");
                return;
            }

            let obj;
            try {
                obj = JSON.parse(raw);
            } catch (err) {
                alert("JSON is not valid. Error: " + err.message);
                setStatus("JSON is invalid. Fix syntax errors.", false);
                return;
            }

            const problems = [];
            const warnings = [];

            if (!obj.title || typeof obj.title !== 'string') {
                problems.push("Missing or invalid title.");
            }
            if (!Array.isArray(obj.ingredients) || obj.ingredients.length === 0) {
                problems.push("Ingredients must be a non-empty array.");
            }
            if (!Array.isArray(obj.instructions) || obj.instructions.length === 0) {
                problems.push("Instructions must be a non-empty array.");
            }

            if (obj.slug && typeof obj.slug === 'string') {
                const slugPattern = /^[a-z0-9]+(?:-[a-z0-9]+)*$/;
                if (!slugPattern.test(obj.slug)) {
                    warnings.push("Slug contains characters outside a-z, 0-9, and hyphens.");
                }
            }

            let message;
            if (problems.length === 0 && warnings.length === 0) {
                message = "‚úì JSON is valid and ready for recipes.json.";
                setStatus(message, true);
            } else if (problems.length === 0 && warnings.length > 0) {
                message = "JSON is valid, but with warnings:\n- " + warnings.join("\n- ");
                setStatus("Valid JSON, with warnings about slug.", true);
            } else {
                message = "Found issues:\n- " + problems.concat(warnings).join("\n- ");
                setStatus("JSON has issues. See alert for details.", false);
            }

            alert(message);
        }

        function setStatus(msg, ok) {
            const el = document.getElementById('validationStatus');
            if (!el) return;
            el.textContent = msg;
            el.style.color = ok ? '#1b7f3b' : '#b00020';
        }

        // --- Copy ---
        function copyToClipboard() {
            const jsonText = document.getElementById('jsonOutput').textContent;
            if (!jsonText.trim()) {
                alert("No JSON to copy.");
                return;
            }

            navigator.clipboard.writeText(jsonText).then(() => {
                const button = document.getElementById('copyButton');
                const original = button.textContent;
                button.textContent = 'Copied!';
                setStatus("JSON copied to clipboard.", true);
                setTimeout(() => {
                    button.textContent = original;
                }, 1500);
            }).catch(err => {
                alert('Could not copy text: ' + err);
            });
        }

        // --- Preview Viewer ---
        function showPreview() {
            const container = document.getElementById('previewContainer');
            const raw = document.getElementById('jsonOutput').textContent.trim();

            if (!raw) {
                container.className = 'empty';
                container.innerHTML = '<span>No JSON available. Generate JSON first.</span>';
                return;
            }

            let recipe;
            try {
                recipe = JSON.parse(raw);
            } catch (err) {
                container.className = 'empty';
                container.innerHTML = '<span>Preview unavailable: JSON is invalid.</span>';
                setStatus("Preview failed: JSON is invalid.", false);
                return;
            }

            container.className = '';
            const lines = [];

            const title = recipe.title || '(Untitled recipe)';
            lines.push('<div class="preview-title">' + escapeHtml(title) + '</div>');

            const metaPieces = [];
            if (recipe.servings) metaPieces.push('<span>' + escapeHtml(recipe.servings) + '</span>');
            if (recipe.prepTime) metaPieces.push('<span>prep: ' + escapeHtml(recipe.prepTime) + '</span>');
            if (recipe.cookTime) metaPieces.push('<span>cook: ' + escapeHtml(recipe.cookTime) + '</span>');
            if (recipe.totalTime) metaPieces.push('<span>total: ' + escapeHtml(recipe.totalTime) + '</span>');
            if (recipe.source) metaPieces.push('<span>source: ' + escapeHtml(recipe.source) + '</span>');

            if (metaPieces.length) {
                lines.push('<div class="preview-meta">' + metaPieces.join('') + '</div>');
            }

            if (recipe.description) {
                lines.push('<div class="preview-description">' + escapeHtml(recipe.description).replace(/\n/g, '<br>') + '</div>');
            }

            if (Array.isArray(recipe.ingredients) && recipe.ingredients.length) {
                lines.push('<div class="preview-section-title">Ingredients</div>');
                lines.push('<ul class="preview-ingredients">');
                for (const item of recipe.ingredients) {
                    lines.push('<li>' + escapeHtml(item) + '</li>');
                }
                lines.push('</ul>');
            }

            if (Array.isArray(recipe.instructions) && recipe.instructions.length) {
                lines.push('<div class="preview-section-title">Instructions</div>');
                lines.push('<ol class="preview-instructions">');
                for (const step of recipe.instructions) {
                    lines.push('<li>' + escapeHtml(step) + '</li>');
                }
                lines.push('</ol>');
            }

            if (recipe.notes) {
                lines.push('<div class="preview-section-title">Notes</div>');
                lines.push('<div class="preview-notes">' + escapeHtml(recipe.notes).replace(/\n/g, '<br>') + '</div>');
            }

            if (recipe.slug) {
                lines.push('<p class="hint" style="margin-top:10px;">Slug: <code>' + escapeHtml(recipe.slug) + '</code></p>');
            }

            container.innerHTML = lines.join('\n');
        }

        function escapeHtml(str) {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        // --- Clear helpers ---
        function clearForm() {
            document.getElementById('recipeForm').reset();
            document.getElementById('slug').dataset.autoGenerated = 'false';
            document.getElementById('jsonOutput').textContent = '';
            document.getElementById('copyButton').disabled = true;
            document.getElementById('previewContainer').className = 'empty';
            document.getElementById('previewContainer').innerHTML = '<span>No preview yet. Generate JSON, then click ‚ÄúPreview‚Äù.</span>';
            setStatus("Fields cleared.", true);
        }
    </script>
</body>
</html>
